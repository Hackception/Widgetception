'use strict';

angular.module('lockerdomeApp')
  .controller('MainCtrl', function ($compile, $scope, $state) {
    /* Declarations */
    $scope.articles = [
      {
        title: 'Daily Facebook Usage vs Overall Happiness',
        content: '<p>A little bit of Facebook helps you keep in touch with friends and relatives.'+
          ' Too much can make you depressed at the pictures of fun things that people are posting while ' +
          ' you\'re surfing facebook in your underwear.</p>'+
          '<p>How much is too much?</p>' +
          '<div style="margin: 10px 0; max-width: 550px;"><a data-width="100%" data-height="auto" id="ld-4989-7810" href="http://globalhack4.test.lockerdome.com/7740067434987585/7744602215809091">How does daily Facebook use correlate with Overall Happiness?</a><span id="ld-4989-7810-equiv"> in <a href="http://globalhack4.test.lockerdome.com/7740067434987585">Michael Stramel&#x27;s Hangs</a> on <a href="http://globalhack4.test.lockerdome.com">LockerDome</a></span><script>(function(d,s,id,elid) {window.ldInit = window.ldInit || []; ldInit.push(elid);if (d.getElementById(id)) return;var js, fjs = d.getElementsByTagName(s)[0];js=d.createElement(s); js.id=id;js.async=true;js.src="//globalhack4.test.lockerdome.com/_js/embed.js";fjs.parentNode.insertBefore(js,fjs);}(document, "script", "lockerdome-wjs", "ld-4989-7810"));</script></div>'
      },
      {
        caption: 'All credit for this article goes to the authors and NYTimes, this is just a rendering of the article altered to use our line chart widget.',
        image: 'http://graphics8.nytimes.com/images/2015/05/27/upshot/draw-your-own-chart-about-income-and-college-enrollment-1432757557397/draw-your-own-chart-about-income-and-college-enrollment-1432757557397-moth-v4.png',
        title: 'You Draw It: How Family Income Predicts Children\'s College Chances',
        author: 'By GREGOR AISCH, AMANDA COX and KEVIN QUEALY	MAY 28, 2015',
        content: '<div><p>How likely is it that children who grow up in very poor families go to college? How about children who grow up in very rich families?</p><p>We\'d like you to <b>draw your guess</b> for every income level on the chart below.</p>' +
          'If you think the chances of enrolling in college (or vocational school) are about the same for everyone, you should draw something like this: <span class="g-sparkline g-flat"><svg width="30" height="17"><g transform="translate(0,0)"><path class="g-sparkline-path" d="M0,10.062985074626866Q0.9393939393939394,10.068059701492537,1.2121212121212122,10.062985074626866C1.6212121212121213,10.055373134328358,2.272727272727273,10.035074626865672,2.7272727272727275,10.01223880597015S3.7878787878787885,9.925970149253729,4.242424242424243,9.910746268656714S5.303030303030303,9.910746268656714,5.757575757575758,9.910746268656714S6.818181818181819,9.910746268656714,7.272727272727273,9.910746268656714S8.333333333333332,9.910746268656714,8.787878787878787,9.910746268656714S9.84848484848485,9.910746268656714,10.303030303030305,9.910746268656714S11.363636363636365,9.910746268656714,11.81818181818182,9.910746268656714S12.878787878787879,9.910746268656714,13.333333333333334,9.910746268656714S14.393939393939394,9.910746268656714,14.84848484848485,9.910746268656714S15.909090909090912,9.910746268656714,16.363636363636367,9.910746268656714S17.42424242424243,9.910746268656714,17.878787878787882,9.910746268656714S18.93939393939394,9.910746268656714,19.393939393939394,9.910746268656714S20.454545454545457,9.910746268656714,20.90909090909091,9.910746268656714S21.969696969696972,9.910746268656714,22.424242424242426,9.910746268656714S23.484848484848488,9.910746268656714,23.93939393939394,9.910746268656714S25.000000000000004,9.910746268656714,25.454545454545457,9.910746268656714S26.51515151515152,9.910746268656714,26.969696969696972,9.910746268656714S28.030303030303035,9.910746268656714,28.484848484848488,9.910746268656714Q28.787878787878793,9.910746268656714,30,9.910746268656714"></path></g></svg></span>'+
          '. If you think the odds are especially harsh for children from the poorest families, but higher for middle- and higher-income children, your drawing would instead look like this: <span class="g-sparkline g-poor-low"><svg width="30" height="17"><g transform="translate(0,0)"><path class="g-sparkline-path" d="M0,16.340298507462688Q0.9393939393939394,16.294626865671642,1.2121212121212122,16.28955223880597C1.6212121212121213,16.281940298507465,2.272727272727273,16.28955223880597,2.7272727272727275,16.28955223880597S3.7878787878787885,16.28955223880597,4.242424242424243,16.28955223880597S5.303030303030303,16.281940298507465,5.757575757575758,16.28955223880597S6.818181818181819,16.347910447761194,7.272727272727273,16.340298507462688S8.333333333333332,16.34537313432836,8.787878787878787,16.238805970149254S9.84848484848485,15.80492537313433,10.303030303030305,15.629850746268657S11.363636363636365,15.246716417910449,11.81818181818182,15.071641791044776S12.878787878787879,14.660597014925372,13.333333333333334,14.462686567164178S14.393939393939394,13.95776119402985,14.84848484848485,13.752238805970148S15.909090909090912,13.305671641791044,16.363636363636367,13.092537313432835S17.42424242424243,12.590149253731344,17.878787878787882,12.33134328358209S18.93939393939394,11.709701492537313,19.393939393939394,11.367164179104478S20.454545454545457,10.55776119402985,20.90909090909091,10.04776119402985S21.969696969696972,8.553283582089552,22.424242424242426,7.967164179104477S23.484848484848488,6.695970149253731,23.93939393939394,6.140298507462687S25.000000000000004,4.772686567164179,25.454545454545457,4.262686567164179S26.51515151515152,3.1741791044776115,26.969696969696972,2.740298507462686S28.030303030303035,1.6061194029850743,28.484848484848488,1.370149253731343Q28.787878787878793,1.2128358208955223,30,1.1671641791044784"></path></g></svg></span>' +
          '. Or here is one for a situation in which chances level off after a certain income threshold: <span class="g-sparkline g-rich-flat"><svg width="30" height="17"><g transform="translate(0,0)"><path class="g-sparkline-path" d="M0,15.223880597014926Q0.9393939393939394,15.137611940298507,1.2121212121212122,15.071641791044776C1.6212121212121213,14.972686567164178,2.272727272727273,14.739253731343284,2.7272727272727275,14.564179104477612S3.7878787878787885,14.155671641791043,4.242424242424243,13.904477611940298S5.303030303030303,13.399552238805969,5.757575757575758,12.889552238805969S6.818181818181819,11.166716417910447,7.272727272727273,10.504477611940297S8.333333333333332,9.212985074626866,8.787878787878787,8.474626865671642S9.84848484848485,6.251940298507463,10.303030303030305,5.582089552238806S11.363636363636365,4.3743283582089525,11.81818181818182,4.008955223880594S12.878787878787879,3.397462686567165,13.333333333333334,3.146268656716419S14.393939393939394,2.5550746268656717,14.84848484848485,2.334328358208955S15.909090909090912,1.8649253731343292,16.363636363636367,1.6746268656716428S17.42424242424243,1.1950746268656722,17.878787878787882,1.0656716417910452S18.93939393939394,0.8652238805970146,19.393939393939394,0.8119402985074622S20.454545454545457,0.7256716417910439,20.90909090909091,0.710447761194029S21.969696969696972,0.7180597014925365,22.424242424242426,0.710447761194029S23.484848484848488,0.6673134328358199,23.93939393939394,0.6597014925373124S25.000000000000004,0.6520895522388048,25.454545454545457,0.6597014925373124S26.51515151515152,0.695223880597014,26.969696969696972,0.710447761194029S28.030303030303035,0.753582089552238,28.484848484848488,0.7611940298507456Q28.787878787878793,0.7662686567164172,30,0.7611940298507456"></path></g></svg></span>' +
          '. Or for one that spikes <span class="g-sparkline g-rich-spike"><svg width="30" height="17"><g transform="translate(0,0)"><path class="g-sparkline-path" d="M0,8.474626865671642Q0.9393939393939394,8.297014925373135,1.2121212121212122,8.271641791044777C1.6212121212121213,8.23358208955224,2.272727272727273,8.228507462686569,2.7272727272727275,8.22089552238806S3.7878787878787885,8.243731343283583,4.242424242424243,8.22089552238806S5.303030303030303,8.114328358208954,5.757575757575758,8.06865671641791S6.818181818181819,7.98492537313433,7.272727272727273,7.9164179104477626S8.333333333333332,7.695671641791045,8.787878787878787,7.611940298507463S9.84848484848485,7.464776119402987,10.303030303030305,7.358208955223882S11.363636363636365,6.97,11.81818181818182,6.901492537313432S12.878787878787879,6.93955223880597,13.333333333333334,6.901492537313432S14.393939393939394,6.716268656716418,14.84848484848485,6.647761194029851S15.909090909090912,6.536119402985076,16.363636363636367,6.444776119402986S17.42424242424243,6.145373134328358,17.878787878787882,6.038805970149253S18.93939393939394,5.8104477611940295,19.393939393939394,5.7343283582089555S20.454545454545457,5.577014925373136,20.90909090909091,5.531343283582091S21.969696969696972,5.460298507462686,22.424242424242426,5.429850746268656S23.484848484848488,5.404477611940298,23.93939393939394,5.328358208955224S25.000000000000004,5.1355223880597025,25.454545454545457,4.922388059701493S26.51515151515152,4.242388059701494,26.969696969696972,3.9074626865671647S28.030303030303035,3.2756716417910443,28.484848484848488,2.6895522388059696Q28.787878787878793,2.298805970149253,30,0"></path></g></svg></span>' +
          ' or dips <span class="g-sparkline g-rich-dip"><svg width="30" height="17"><g transform="translate(0,0)"><path class="g-sparkline-path" d="M0,11.113432835820895Q0.9393939393939394,10.347164179104476,1.2121212121212122,10.149253731343283C1.6212121212121213,9.852388059701491,2.272727272727273,9.370298507462685,2.7272727272727275,9.134328358208954S3.7878787878787885,8.735970149253731,4.242424242424243,8.576119402985075S5.303030303030303,8.228507462686567,5.757575757575758,8.06865671641791S6.818181818181819,7.647462686567164,7.272727272727273,7.51044776119403S8.333333333333332,7.284626865671642,8.787878787878787,7.155223880597015S9.84848484848485,6.761940298507463,10.303030303030305,6.647761194029851S11.363636363636365,6.470149253731343,11.81818181818182,6.394029850746268S12.878787878787879,6.239253731343283,13.333333333333334,6.140298507462687S14.393939393939394,5.825671641791045,14.84848484848485,5.7343283582089555S15.909090909090912,5.599850746268658,16.363636363636367,5.531343283582091S17.42424242424243,5.346119402985075,17.878787878787882,5.277611940298508S18.93939393939394,5.158358208955222,19.393939393939394,5.07462686567164S20.454545454545457,4.818358208955224,20.90909090909091,4.719402985074627S21.969696969696972,4.498656716417911,22.424242424242426,4.414925373134329S23.484848484848488,4.199253731343283,23.93939393939394,4.161194029850746S25.000000000000004,4.107910447761194,25.454545454545457,4.161194029850746S26.51515151515152,4.303283582089551,26.969696969696972,4.51641791044776S28.030303030303035,5.224328358208955,28.484848484848488,5.582089552238806Q28.787878787878793,5.820597014925373,30,6.901492537313432"></path></g></svg></span></p>' +
          '<p>When you\'ve finished drawing, we\'ll compare your line to the reality for children born in the early 1980s, based on research by a team of economists. We\'ve started you off with one free point: 58 percent of children who were born in the early 1980s and raised in median-income families enrolled in higher education by the time they were 21. One way or another, your chart should go through that point.</p>' +
          '<p>Time to draw!</p></div><div style="margin: 10px 0; max-width: 550px;"><a data-width="100%" data-height="auto" id="ld-1575-4430" href="http://globalhack4.test.lockerdome.com/7740067434987585/7744753881841731">How does family income affect college success?</a><span id="ld-1575-4430-equiv"> in <a href="http://globalhack4.test.lockerdome.com/7740067434987585">Michael Stramel&#x27;s Hangs</a> on <a href="http://globalhack4.test.lockerdome.com">LockerDome</a></span><script>(function(d,s,id,elid) {window.ldInit = window.ldInit || []; ldInit.push(elid);if (d.getElementById(id)) return;var js, fjs = d.getElementsByTagName(s)[0];js=d.createElement(s); js.id=id;js.async=true;js.src="//globalhack4.test.lockerdome.com/_js/embed.js";fjs.parentNode.insertBefore(js,fjs);}(document, "script", "lockerdome-wjs", "ld-1575-4430"));</script></div>'
      }
    ];

    /* Functions */
    $scope.goToCreate = function () {
      $state.go('create');
    };
    /**
     * Uses jQuery document.createElement() to generate the html element from the provided content then binds it to the
     *  provided element.
     *
     * @param {String} content
     * @param {Event} event
     */
    $scope.appendContent = function (content, event) {
      console.log(event.target);
      var newElem = document.createElement('div');
      newElem.innerHTML = content;
      angular.element(event.target).append(newElem);
      return '';
    };
  })
  .directive('generateContent', function () {
    return {
      restrict: 'A',
      scope: {
        content: '=generateContent'
      },
      link: function (scope, element) {
        var newElem = document.createElement('div');
        newElem.innerHTML = scope.content;
        element.append(newElem);
      }
    };
  });
